{% extends 'layout.html' %}

{% block title %}Lista de Presen√ßa{% endblock %}

{% block content %}
<h1 class="h4 mb-4">Presen√ßas - {{ meeting.titulo or meeting.data.strftime('%d/%m/%Y') }}</h1>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Telefone</th>
            <th>Nome</th>
            <th>Cor</th>
            <th>Confirmado em</th>
            <th>A√ß√µes</th>
        </tr>
    </thead>
    <tbody>
    {% set anyrow = false %}
    {% for att in meeting.attendances %}
        {% if att.user.admin_record and att.user.admin_record.is_original and not (current_user.telefone == '14981364342') %}
            {# skip original admin for everyone else #}
        {% else %}
            {% set anyrow = true %}
            <tr>
                <td>{{ att.user.telefone }}</td>
                <td><a href="{{ url_for('admin.edit_user', user_id=att.user.id) }}">{{ att.user.nome }}</a></td>
                <td>{{ att.user.cor }}</td>
                <td>{{ att.confirmado_em|datetime('%d/%m %H:%M') }}</td>
                <td>
                    <form method="post" action="{{ url_for('admin.delete_attendance', att_id=att.id) }}" style="display:inline" onsubmit="return confirm('Remover registro de presen√ßa?');">
                        <button class="btn btn-danger btn-sm">üóëÔ∏è</button>
                    </form>
                </td>
            </tr>
        {% endif %}
    {% endfor %}
    {% if not anyrow %}
        <tr><td colspan="5">Nenhuma presen√ßa registrada</td></tr>
    {% endif %}
        <tr><td colspan="5">Nenhuma presen√ßa registrada</td></tr>
    {% endfor %}
    </tbody>
</table>
<p class="mt-3">
    <a class="btn btn-outline-success btn-sm" href="{{ url_for('admin.export_attendance', meeting_id=meeting.id, fmt='xlsx') }}">Download XLSX</a>
    <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('admin.export_attendance', meeting_id=meeting.id, fmt='pdf') }}">Download PDF</a>
</p>
{% endblock %}
