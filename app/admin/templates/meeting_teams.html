{% extends 'layout.html' %}

{% block title %}Equipes - {{ meeting.titulo or meeting.data.strftime('%d/%m/%Y') }}{% endblock %}

{% block content %}
{% block breadcrumbs %}
  <li class="breadcrumb-item"><a href="{{ url_for('admin.event_detail', event_id=meeting.event_id) }}">{{ meeting.event.nome }}</a></li>
  <li class="breadcrumb-item"><a href="{{ url_for('admin.meeting_detail', meeting_id=meeting.id) }}">ReuniÃ£o {{ meeting.data.strftime('%d/%m/%Y') }}</a></li>
  <li class="breadcrumb-item active" aria-current="page">Equipes</li>
{% endblock %}
<h1 class="h3 mb-4">Equipes para reuniÃ£o {{ meeting.titulo or meeting.data.strftime('%d/%m/%Y') }}</h1>
<form method="post" class="mb-3 row gx-2 gy-2 align-items-end">
  <div class="col-auto">
     <label class="form-label">Nome da equipe</label>
     <input type="text" name="name" class="form-control" required />
  </div>
  <div class="col-auto">
     <button class="btn btn-primary">Criar equipe</button>
  </div>
</form>
{% if teams %}
<div class="row">
  {% for team in teams %}
  <div class="col-12 col-md-6 col-lg-4 mb-4">
    <div class="card h-100">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span class="fw-bold">{{ team.nome }}</span>
        <form method="post" action="{{ url_for('admin.delete_team', meeting_id=meeting.id, team_id=team.id) }}" class="m-0">
           <button class="btn btn-sm btn-danger">ğŸ—‘ï¸</button>
        </form>
      </div>
      <div class="card-body">
        {% if team.users %}
          {# leader displayed prominently above the rest #}
          {% if team.leader and team.leader in team.users %}
          <p class="mb-2">
            <strong>{{ team.leader.nome }} - {{ team.leader.telefone }}</strong>
            <small class="text-muted">(lÃ­der)</small>
          </p>
          {% endif %}
          <ul class="list-unstyled mb-2">
            {% for u in team.users %}
              {% if not team.leader or u.id != team.leader.id %}
                <li><a href="{{ url_for('admin.edit_user', user_id=u.id) }}">{{ u.nome }}</a> - {{ u.telefone }}</li>
              {% endif %}
            {% endfor %}
          </ul>
        {% else %}
          <p class="mb-2"><em>Sem membros</em></p>
        {% endif %}
        <a href="{{ url_for('admin.manage_team_members', team_id=team.id) }}" class="btn btn-sm btn-outline-secondary">Gerenciar membros</a>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
   <p>Nenhuma equipe criada.</p>
{% endif %}
{% endblock %}
