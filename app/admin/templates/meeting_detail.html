{% extends 'layout.html' %}

{% block title %}ReuniÃ£o - AdministraÃ§Ã£o{% endblock %}

{% block content %}
{% block breadcrumbs %}
  <li class="breadcrumb-item"><a href="{{ url_for('admin.event_detail', event_id=meeting.event_id) }}">{{ meeting.event.nome }}</a></li>
  <li class="breadcrumb-item active" aria-current="page">ReuniÃ£o {{ meeting.data.strftime('%d/%m/%Y') }}</li>
{% endblock %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 mb-0"><span aria-hidden="true">ğŸ“</span> ReuniÃ£o em {{ meeting.data.strftime('%d/%m/%Y') }}</h1>
    <div>
      <a href="{{ url_for('admin.edit_meeting', meeting_id=meeting.id) }}" class="btn btn-secondary btn-sm">âœï¸ Editar reuniÃ£o</a>
      <form method="post" action="{{ url_for('admin.delete_meeting', meeting_id=meeting.id) }}" class="d-inline ms-1" onsubmit="return confirm('Excluir reuniÃ£o e todos os dados relacionados?');">
          <button type="submit" class="btn btn-danger btn-sm">ğŸ—‘ï¸</button>
      </form>
    </div>
</div>
<p>Evento: <span aria-hidden="true">ğŸ“…</span> {{ meeting.event.nome }}</p>
<p><span aria-hidden="true">ğŸ‘¥</span> PresenÃ§as: {{ meeting.attendances|length }}</p>
<form method="post" action="{{ url_for('admin.generate_qrcode', meeting_id=meeting.id) }}" class="mb-4">
    <button type="submit" class="btn btn-primary">ğŸ“· Gerar QR Code</button>
</form>
<h5 class="mt-4">Lista de presenÃ§as</h5>
<div class="mb-3">
    <a href="{{ url_for('admin.attendance_list', meeting_id=meeting.id) }}" class="btn btn-secondary btn-sm">Ver em nova pÃ¡gina</a>
    <a href="{{ url_for('admin.export_attendance', meeting_id=meeting.id, fmt='xlsx') }}" class="btn btn-outline-success btn-sm">Exportar XLSX</a>
    <a href="{{ url_for('admin.export_attendance', meeting_id=meeting.id, fmt='pdf') }}" class="btn btn-outline-secondary btn-sm">Exportar PDF</a>
</div>
{% if meeting.attendances %}
<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Telefone</th>
            <th>Nome</th>
            <th>Cor</th>
            <th>Confirmado em</th>
            <th>AÃ§Ãµes</th>
        </tr>
    </thead>
    <tbody>
        {% for att in meeting.attendances %}
        <tr>
            <td>{{ att.user.telefone }}</td>
            <td><a href="{{ url_for('admin.edit_user', user_id=att.user.id) }}">{{ att.user.nome }}</a></td>
            <td>{{ att.user.cor }}</td>
            <td>{{ att.confirmado_em|datetime('%d/%m %H:%M') }}</td>
            <td>
                <form method="post" action="{{ url_for('admin.delete_attendance', att_id=att.id) }}" style="display:inline" onsubmit="return confirm('Remover registro de presenÃ§a?');">
                    <button class="btn btn-danger btn-sm">ğŸ—‘ï¸</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<a href="{{ url_for('admin.meeting_missed', meeting_id=meeting.id) }}" class="btn btn-warning btn-sm mt-2">Ver faltantes</a>
{% else %}
<p>Nenhuma presenÃ§a registrada ainda.</p>
{% endif %}
<ul class="list-unstyled">
    {% if meeting.special %}
    <li><a href="{{ url_for('admin.meeting_teams', meeting_id=meeting.id) }}" class="btn btn-secondary btn-sm mb-3">Gerenciar equipes</a></li>
    {% endif %}
    {% for qr in meeting.qrcodes %}
        <li>
            <div class="mb-2">
                <a href="{{ url_for('admin.qrcode_view', qrcode_id=qr.id) }}" class="btn btn-sm btn-outline-primary">ğŸ” Visualizar QR</a>
                <span class="mx-2">Status: <strong>{{ 'Aberto' if qr.active else 'Fechado' }}</strong></span>
                <form method="post" action="{{ url_for('admin.qrcode_toggle', qrcode_id=qr.id) }}" style="display:inline">
                    <button type="submit" class="btn btn-sm btn-outline-secondary">{{ 'ğŸ”’ Fechar' if qr.active else 'ğŸ”“ Abrir' }}</button>
                </form>
                <div class="mt-1"><small>{{ url_for('main.scan', token=qr.token, _external=True) }}</small></div>
            </div>
        </li>
    {% else %}
        <li>Nenhum QR code gerado</li>
    {% endfor %}
</ul>
{% endblock %}
