{% extends 'layout.html' %}

{% block title %}Confirmação de presença{% endblock %}

{% block content %}
<div class="w-100 px-3" style="max-width:400px;">
    <div class="text-center mb-3">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" style="max-width:100px;" />
        <h4 class="mt-2">FACE A FACE COM DEUS PARA HOMENS</h4>
        <h5 class="mb-4">{{ meeting.titulo or meeting.data.strftime('%d/%m/%Y') }}</h5>
    </div>
    <h1 class="h3 text-center mb-4">Confirmação de presença</h1>
    <p class="text-center">{{ meeting.event.nome }}<br>{{ meeting.data.strftime('%d/%m/%Y') }}</p>
    {% if closed %}
        <p class="mt-2 text-danger fw-bold text-center">Inscrições fechadas</p>
    {% else %}
        <p class="mt-2 text-center">Informe o telefone:</p>
        <form method="post" class="mt-3">
            <div class="mb-2">
                <input id="phone" type="text" name="telefone" class="form-control" required placeholder="(xx) xxxxx-xxxx" {% if closed %}disabled{% endif %} autofocus>
            </div>
            <button type="submit" class="btn btn-primary w-100" {% if closed %}disabled{% endif %}>Enviar</button>
        </form>
    {% endif %}
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mt-3">
        {% for category, message in messages %}
          <div class="alert alert-{{ 'success' if category=='success' else 'danger' }}" role="alert">
              {{ message }}
          </div>
        {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
</div>
<script>
const phoneInput = document.getElementById('phone');
if(phoneInput){
    phoneInput.addEventListener('input', function(e) {
        let v = phoneInput.value.replace(/\D/g, '');
        if (v.length > 11) v = v.slice(0,11);
        v = v.replace(/^(\d{2})(\d)/g, '($1) $2');
        v = v.replace(/(\d{5})(\d)/, '$1-$2');
        phoneInput.value = v;
    });
}
</script>
{% endblock %}
